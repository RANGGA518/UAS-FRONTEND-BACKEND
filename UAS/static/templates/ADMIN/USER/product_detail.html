<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>{{ product.nama_barang }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="bg-light">
<nav class="navbar navbar-expand-lg bg-white shadow-sm sticky-top">
    <div class="container">

        <!-- BRAND -->
        <a class="navbar-brand fw-bold text-primary me-3" href="/">
            Minimarket
        </a>

        <!-- TOGGLER (MOBILE) -->
        <button class="navbar-toggler" type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarMain"
                aria-controls="navbarMain"
                aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- COLLAPSE AREA -->
        <div class="collapse navbar-collapse" id="navbarMain">

            <!-- SEARCH -->
            <div class="mx-lg-auto my-3 my-lg-0 w-100 d-flex justify-content-center position-relative">

                {% if pesan %}
                <div id="searchNotif" class="search-floating-alert">
                    <div class="alert alert-warning text-center shadow-sm mb-0">
                        {{ pesan }}
                    </div>
                </div>
                {% endif %}

                <form
                    action="{{ request.path }}"
                    method="get"
                    class="d-flex align-items-center search-wrapper w-100"
                    style="max-width:600px;"
                    onsubmit="return handleSearch(this)">

                    <input type="search"
                           name="q"
                           class="form-control search-input"
                           placeholder="Cari produk..."
                           value="{{ keyword or '' }}">

                    <button type="submit" class="btn btn-primary search-btn ms-2">
                        <i class="bi bi-search"></i>
                    </button>
                </form>
            </div>

            <!-- RIGHT MENU -->
            <div class="d-flex align-items-center gap-3 ms-lg-4">

                <!-- CART -->
                <a href="/cart" class="position-relative text-decoration-none text-dark">
                    <i class="bi bi-cart3 fs-4"></i>
                    {% if cart_count > 0 %}
                    <span class="cart-badge">{{ cart_count }}</span>
                    {% endif %}
                </a>

                {% if session.get("user") %}
                <a href="/profile" class="user-profile d-flex align-items-center text-decoration-none text-dark">
                    <img src="{{ url_for('static', filename='img/user/images.png') }}" width="32" height="32" class="rounded-circle me-2">
                    <span class="fw-semibold">
                        Hi,&nbsp;{{ session.user }}
                    </span>
                </a>
                {% else %}
                <a href="/login" class="btn btn-outline-primary btn-sm">Masuk</a>
                <a href="/register" class="btn btn-primary btn-sm">Daftar</a>
                {% endif %}

            </div>

        </div>
    </div>
</nav>

<div class="container mt-4">

    <!-- BREADCRUMB -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb bg-white px-3 py-2 rounded shadow-sm">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item active">{{ product.nama_barang }}</li>
        </ol>
    </nav>

    <div class="row g-4">

        <!-- ================= LEFT : IMAGE ================= -->
        <div class="col-md-4">
            <div class="card shadow-sm p-3">
                <img src="{{ url_for('static', filename='img/produk/' ~ product.gambar) }}"
                     class="img-fluid rounded mb-3"
                     style="object-fit:contain; max-height:380px;">

                <!-- THUMBNAIL (dummy, future ready) -->
                <div class="d-flex gap-2 justify-content-center">
                    <img src="{{ url_for('static', filename='img/produk/' ~ product.gambar) }}"
                         class="border rounded"
                         style="width:60px;height:60px;object-fit:contain;">
                </div>
            </div>
        </div>

        <!-- ================= CENTER : DETAIL ================= -->
        <div class="col-md-5">
            <h4 class="fw-bold mb-2">{{ product.nama_barang }}</h4>

            <div class="mb-3">
                <span class="text-muted">Brand :</span>
                <span class="fw-semibold text-primary">Minimarket</span>
            </div>

            <h3 class="text-primary fw-bold mb-4">
                Rp {{ product.harga | rupiah }}
            </h3>

            <hr>

            <h6 class="fw-bold mb-2">Deskripsi Produk</h6>

            {% if product.deskripsi %}
            <p class="text-muted" style="line-height:1.7;">
                {{ product.deskripsi }}
            </p>
            {% else %}
            <p class="text-muted fst-italic">
                Tidak ada deskripsi produk.
            </p>
            {% endif %}
        </div>

        <!-- ================= RIGHT : BUY BOX ================= -->
        <div class="col-md-3">
            <div class="card shadow-sm p-3 position-sticky" style="top:90px;">

                <form method="POST" action="/add-to-cart" id="addToCartForm">
                    <input type="hidden" name="kode" value="{{ product.kode_barang }}">

                    <label class="form-label fw-semibold">Jumlah Pembelian</label>

                    <div class="input-group mb-3">
                        <button class="btn btn-outline-secondary"
                                type="button"
                                onclick="qty.value = Math.max(1, qty.value-1)">âˆ’</button>

                        <input type="number"
                               name="qty"
                               id="qty"
                               value="1"
                               min="1"
                               class="form-control text-center">

                        <button class="btn btn-outline-secondary"
                                type="button"
                                onclick="qty.value++">+</button>
                    </div>

                    <button type="submit"
                            class="btn btn-primary w-100 fw-semibold py-2">
                        + Keranjang
                    </button>
                </form>

                <hr>

                <div class="small text-muted">
                    <p class="mb-1">ðŸšš Pengiriman Instan</p>
                    <p class="mb-0">ðŸ’° Gratis Ongkir</p>
                </div>
            </div>
        </div>

    </div>
</div>

<footer class="footer mt-5">
    <div class="container py-5">
        <div class="row g-4">

            <!-- BRAND -->
            <div class="col-lg-4 col-md-6">
                <h5 class="footer-brand">Minimarket</h5>
                <p class="footer-text">
                    Minimarket online untuk kebutuhan harian Anda.
                    Mudah, cepat, dan terpercaya.
                </p>

                <div class="footer-social">
                    <a href="#"><i class="bi bi-facebook"></i></a>
                    <a href="#"><i class="bi bi-instagram"></i></a>
                    <a href="#"><i class="bi bi-twitter-x"></i></a>
                </div>
            </div>

            <!-- MENU -->
            <div class="col-lg-2 col-md-6">
                <h6 class="footer-title">Menu</h6>
                <ul class="footer-links">
                    <li><a href="/">Beranda</a></li>
                    <li><a href="/cart">Keranjang</a></li>
                    <li><a href="/login">Masuk</a></li>
                    <li><a href="/register">Daftar</a></li>
                </ul>
            </div>

            <!-- KATEGORI -->
            <div class="col-lg-3 col-md-6">
                <h6 class="footer-title">Kategori Populer</h6>
                <ul class="footer-links">
                    <li><a href="#">Makanan</a></li>
                    <li><a href="#">Minuman</a></li>
                    <li><a href="#">Kebutuhan Rumah</a></li>
                    <li><a href="#">Produk Promo</a></li>
                </ul>
            </div>

            <!-- KONTAK -->
            <div class="col-lg-3 col-md-6">
                <h6 class="footer-title">Kontak Kami</h6>
                <ul class="footer-contact">
                    <li><i class="bi bi-geo-alt"></i> Indonesia</li>
                    <li><i class="bi bi-envelope"></i> support@minimarket.com</li>
                    <li><i class="bi bi-whatsapp"></i> 0812-3456-7890</li>
                </ul>
            </div>

        </div>
    </div>

    <!-- COPYRIGHT -->
    <div class="footer-bottom">
        <div class="container text-center">
            <small>Â© 2026 Minimarket. All rights reserved.</small>
        </div>
    </div>
</footer>

{% if not session.get("user_id") %}
<script>
    document.getElementById("addToCartForm")
        .addEventListener("submit", function (e) {
            e.preventDefault();
            alert("Silakan login atau daftar terlebih dahulu untuk menambahkan produk ke keranjang.");
            window.location.href = "/login";
        });
</script>
{% endif %}

<script>
    const notif = document.getElementById("searchNotif");

    if (notif) {
        setTimeout(() => {
            notif.style.opacity = "0";
            notif.style.transform = "translateY(-10px)";

            setTimeout(() => {
                notif.remove();
            }, 300);
        }, 3000);
    }

    function handleSearch(form) {
        const input = form.querySelector('input[name="q"]');
        if (!input.value.trim()) {
            return false;
        }
        return true;
    }
</script>


</body>
</html>
